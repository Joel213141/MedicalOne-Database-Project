-- Drop existing tables if they exist
DROP TABLE IF EXISTS 
    PATIENT, BOOKING, VACCINATION, APPOINTMENT, CENTRE, TIMING, DOCTOR, MANAGER_HISTORY;

-- Create Patient Table
CREATE TABLE PATIENT (
    PAT_ID NUMERIC,
    PAT_NAME VARCHAR(10),
    PAT_ADD VARCHAR(16),
    PAT_NUM CHAR(8),
    PRIMARY KEY (PAT_ID)
);

-- Create Booking Table
CREATE TABLE BOOKING (
    BOOKING_ID NUMERIC,
    PAT_ID NUMERIC,
    DOC_ID NUMERIC,
    BOOKING_DATE DATE,
    PRIMARY KEY (BOOKING_ID),
    FOREIGN KEY (PAT_ID) REFERENCES PATIENT(PAT_ID)
);

-- Create Vaccination Table
CREATE TABLE VACCINATION (
    BOOKING_ID NUMERIC,
    VAC_TYPE VARCHAR(10),
    VAC_DOSE NUMERIC,
    MCARE_NUM NUMERIC,
    PRIMARY KEY (BOOKING_ID),
    CONSTRAINT VAC_TYPE CHECK (VAC_TYPE IN ('Covid', 'Polio', 'Measles'))
);

-- Create Appointment Table
CREATE TABLE APPOINTMENT (
    BOOKING_ID NUMERIC,
    PAT_TYPE VARCHAR(10),
    PRIMARY KEY (BOOKING_ID),
    CONSTRAINT PAT_TYPE CHECK (PAT_TYPE IN ('Checkup', 'Treatment'))
);

-- Create Centre Table
CREATE TABLE CENTRE (
    C_ID NUMERIC,
    C_NAME CHAR(10),
    C_ADD CHAR(40),
    C_NUM CHAR(12),
    C_FAX CHAR(12),
    C_PRC_MGR CHAR(10),
    PRIMARY KEY (C_ID)
);

-- Create Timing Table
CREATE TABLE TIMING (
    DAYS VARCHAR(10),
    C_ID NUMERIC,
    OPENING_HOUR TIME,
    CLOSING_HOUR TIME,
    PRIMARY KEY (DAYS),
    FOREIGN KEY (C_ID) REFERENCES CENTRE(C_ID)
);

-- Create Doctor Table
CREATE TABLE DOCTOR (
    DOC_ID NUMERIC,
    C_ID NUMERIC,
    DOC_NAME VARCHAR(10),
    DOC_NUM CHAR(12),
    DOC_SOURCE VARCHAR(10),
    PRIMARY KEY (DOC_ID),
    FOREIGN KEY (C_ID) REFERENCES CENTRE(C_ID)
);

-- Create Manager History Table
CREATE TABLE MANAGER_HISTORY (
    C_ID NUMERIC,
    DATE_ASSIGN DATE,
    PRIMARY KEY (C_ID)
);

-- Insert Data into Tables
INSERT INTO PATIENT VALUES(003, 'Kevin', 'Melbourne', '728-9897');
INSERT INTO PATIENT VALUES(004, 'Sam', 'Perth', '428-9453');
INSERT INTO PATIENT VALUES(005, 'Prad', 'Sydney', '328-2936');
INSERT INTO PATIENT VALUES(006, 'Meylyn', 'Perth', '428-9357');
INSERT INTO PATIENT VALUES(007, 'Jesse', 'Melbourne', '728-0256');

SELECT * FROM PATIENT;

INSERT INTO CENTRE VALUES(3216, 'WaurnPonds', '160 Colac Road Victoria 3216', '03-5243-6111', '03-5243-4533', 'Sandra');
INSERT INTO CENTRE VALUES(3199, 'Frankston', '47 Davey Street Victoria 3199', '03-9781-3966', '03-9783-9614', 'Leslie');
INSERT INTO CENTRE VALUES(3020, 'Sunshine', '324 Hampshire Road Victoria 3020', '03-9310-2947', '03-9310-2948', 'Brandon');
INSERT INTO CENTRE VALUES(3037, 'Sydenham', '523 Melton Highway Victoria 3037', '03-9390-3311', '03-9390-1800', 'Connor');
INSERT INTO CENTRE VALUES(3189, 'Moorabbin', '844 Nepean Highway Victoria 3189', '03-9553-4544', '03-9553-4514', 'Belesmy');

SELECT * FROM CENTRE;

INSERT INTO DOCTOR VALUES(001, '3199', 'Kim', '728-95697', 'Other');
INSERT INTO DOCTOR VALUES(002, '3020', 'Brad', '756-95347', NULL);
INSERT INTO DOCTOR VALUES(003, '3037', 'John', '108-94397', 'Medicare');
INSERT INTO DOCTOR VALUES(004, '3199', 'Miguel', '238-93237', NULL);
INSERT INTO DOCTOR VALUES(005, '3216', 'Tory', '645-95097', 'Melbourne Hospital');

SELECT * FROM DOCTOR;

INSERT INTO BOOKING VALUES(001, 003, 002, '2022-02-11');
INSERT INTO BOOKING VALUES(002, 004, 004, '2022-04-21');
INSERT INTO BOOKING VALUES(003, 003, 002, '2022-04-16');
INSERT INTO BOOKING VALUES(004, 003, 002, '2022-08-19');
INSERT INTO BOOKING VALUES(005, 003, 002, '2022-10-04');

SELECT * FROM BOOKING;

INSERT INTO VACCINATION VALUES(001, 'Covid', 2, 12345);
INSERT INTO VACCINATION VALUES(002, 'Polio', 3, 14695);
INSERT INTO VACCINATION VALUES(003, 'Measles', 3, 18535);
INSERT INTO VACCINATION VALUES(004, 'Covid', 2, 18545);
INSERT INTO VACCINATION VALUES(005, 'Measles', 6, 26345);

SELECT * FROM VACCINATION;

INSERT INTO TIMING VALUES('Monday', '3189', '08:20:10', '17:30:15');
INSERT INTO TIMING VALUES('Wednesday', '3037', '09:00:10', '17:30:00');
INSERT INTO TIMING VALUES('Tuesday', '3037', '09:00:10', '17:30:00');
INSERT INTO TIMING VALUES('Friday', '3020', '08:20:10', '17:30:15');
INSERT INTO TIMING VALUES('Thursday', '3189', '08:20:10', '17:30:15');

SELECT * FROM TIMING;

INSERT INTO MANAGER_HISTORY VALUES(3216, '2019-10-04');
INSERT INTO MANAGER_HISTORY VALUES(3199, '2018-06-02');
INSERT INTO MANAGER_HISTORY VALUES(3020, '2018-03-07');
INSERT INTO MANAGER_HISTORY VALUES(3037, '2019-12-04');
INSERT INTO MANAGER_HISTORY VALUES(3189, '2020-02-05');

SELECT * FROM MANAGER_HISTORY;

-- Alter Manager History Table
ALTER TABLE MANAGER_HISTORY 
ADD EMP_NUM NUMERIC DEFAULT 000;

-- Update Manager History Table
UPDATE MANAGER_HISTORY 
SET EMP_NUM = 432 
WHERE C_ID = 3189;

-- Queries
SELECT T.DAYS, C.C_PRC_MGR
FROM TIMING T  
JOIN CENTRE C ON T.C_ID = C.C_ID 
ORDER BY T.DAYS DESC;

SELECT T.DAYS, C.C_PRC_MGR 
FROM TIMING T  
JOIN CENTRE C ON T.C_ID = C.C_ID  
WHERE T.DAYS IN ('Tuesday', 'Friday', 'Saturday', 'Sunday') 
ORDER BY T.DAYS DESC;

UPDATE BOOKING  
SET BOOKING_DATE = CURDATE() 
WHERE PAT_ID = 003;

SELECT * FROM BOOKING;

-- Create View
CREATE VIEW Third_dose_vaccine_centres AS 
SELECT D.C_ID, V.VAC_DOSE, V.VAC_TYPE 
FROM VACCINATION V 
JOIN BOOKING B ON V.BOOKING_ID = B.BOOKING_ID 
JOIN DOCTOR D ON B.DOC_ID = D.DOC_ID 
WHERE V.VAC_DOSE >= 3;

SELECT * FROM Third_dose_vaccine_centres;

-- MedicalOne Database Schema

-- Patient Table
CREATE TABLE PATIENT (
    PAT_ID INT PRIMARY KEY,
    PAT_NAME VARCHAR(255),
    PAT_ADD VARCHAR(255),
    PAT_NUM VARCHAR(20)
);

-- Centre Table
CREATE TABLE CENTRE (
    C_ID INT PRIMARY KEY,
    C_NAME VARCHAR(255),
    C_ADD VARCHAR(255),
    C_OPENING_HOURS VARCHAR(255), -- Note: This should be normalized
    C_NUM VARCHAR(20),
    C_FAX VARCHAR(20),
    C_PRC_MGR VARCHAR(255) -- Note: This should have a history entity
);

-- Doctor Table
CREATE TABLE DOCTOR (
    DOC_ID INT PRIMARY KEY,
    DOC_NAME VARCHAR(255),
    DOC_NUM VARCHAR(20),
    DOC_SOURCE VARCHAR(255) -- Hired by MedicalOne or Allied Health
);

-- Booking Table
CREATE TABLE BOOKING (
    BOOKING_ID INT PRIMARY KEY,
    PAT_ID INT,
    DOC_ID INT,
    DATE DATE,
    TIME TIME,
    FOREIGN KEY (PAT_ID) REFERENCES PATIENT(PAT_ID),
    FOREIGN KEY (DOC_ID) REFERENCES DOCTOR(DOC_ID)
);

-- Vaccinations Table
CREATE TABLE VACCINATIONS (
    BOOKING_ID INT PRIMARY KEY,
    VAC_TYPE VARCHAR(255),
    VAC_DOSE VARCHAR(255),
    MCARE_NUM VARCHAR(20), -- Medicare number
    FOREIGN KEY (BOOKING_ID) REFERENCES BOOKING(BOOKING_ID)
);

-- Appointments Table
CREATE TABLE APPOINTMENTS (
    BOOKING_ID INT PRIMARY KEY,
    PAT_TYPE VARCHAR(255), -- General checkup or specific reason
    FOREIGN KEY (BOOKING_ID) REFERENCES BOOKING(BOOKING_ID)
);

-- Timings Table
CREATE TABLE TIMINGS (
    DAY VARCHAR(10) PRIMARY KEY, -- Days of the week
    OPENING_HOUR TIME,
    CLOSING_HOUR TIME
);

-- Manager History Table
CREATE TABLE MGR_HIST (
    C_ID INT,
    DATE_ASSIGN DATE,
    PRIMARY KEY (C_ID, DATE_ASSIGN),
    FOREIGN KEY (C_ID) REFERENCES CENTRE(C_ID)
);